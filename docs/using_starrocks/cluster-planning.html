<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-using_starrocks/cluster-planning" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">集群规划 | StarRocks 最佳实践手册</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://danjing-coder.github.io/docs/using_starrocks/cluster-planning"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="集群规划 | StarRocks 最佳实践手册"><meta data-rh="true" name="description" content="在部署 StarRocks 之前，进行科学合理的集群规划是确保系统上线后能够稳定、高效运行的基石。一份周全的规划可以避免后期因资源不足或配置不当导致的性能瓶颈和运维难题，并为未来的扩展性提供保障。"><meta data-rh="true" property="og:description" content="在部署 StarRocks 之前，进行科学合理的集群规划是确保系统上线后能够稳定、高效运行的基石。一份周全的规划可以避免后期因资源不足或配置不当导致的性能瓶颈和运维难题，并为未来的扩展性提供保障。"><link data-rh="true" rel="canonical" href="https://danjing-coder.github.io/docs/using_starrocks/cluster-planning"><link data-rh="true" rel="alternate" href="https://danjing-coder.github.io/docs/using_starrocks/cluster-planning" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://danjing-coder.github.io/docs/using_starrocks/cluster-planning" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"集群规划","item":"https://danjing-coder.github.io/docs/using_starrocks/cluster-planning"}]}</script><link rel="stylesheet" href="/assets/css/styles.c70b19cb.css">
<script src="/assets/js/runtime~main.87fe96bf.js" defer="defer"></script>
<script src="/assets/js/main.def23d9e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">StarRocks 文档</b></a><a class="navbar__item navbar__link" href="/docs/intro">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">intro</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">StarRocks 最佳实践指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/using_starrocks/cluster-planning">最佳实践</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/using_starrocks/cluster-planning">规划与部署</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/using_starrocks/cluster-planning">集群规划</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/deployment">部署</a><button aria-label="展开侧边栏分类 &#x27;部署&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/using_starrocks">使用与开发</a><button aria-label="展开侧边栏分类 &#x27;使用与开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/Monitor">运维与监控</a><button aria-label="展开侧边栏分类 &#x27;运维与监控&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/troubleshooting">故障处理</a><button aria-label="展开侧边栏分类 &#x27;故障处理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/governance">集群治理</a><button aria-label="展开侧边栏分类 &#x27;集群治理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/maintenance">集群管理</a><button aria-label="展开侧边栏分类 &#x27;集群管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/principles">StarRocks 原理</a><button aria-label="展开侧边栏分类 &#x27;StarRocks 原理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link">最佳实践</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">规划与部署</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">集群规划</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>集群规划</h1></header>
<p>在部署 StarRocks 之前，进行科学合理的集群规划是确保系统上线后能够稳定、高效运行的基石。一份周全的规划可以避免后期因资源不足或配置不当导致的性能瓶颈和运维难题，并为未来的扩展性提供保障。</p>
<p>本章节将从部署模式选择、组件角色、硬件选型、容量评估和组件部署策略等核心方面，为您提供一份系统性的规划指南。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-部署模式选择">1. 部署模式选择<a href="#1-部署模式选择" class="hash-link" aria-label="1. 部署模式选择的直接链接" title="1. 部署模式选择的直接链接">​</a></h2>
<p>StarRocks 支持两种主流的部署模式，这是规划时需要做出的第一个、也是最重要的决策。</p>
<ul>
<li>
<p><strong>存算一体 (Shared-Nothing):</strong> 这是最经典和常用的部署模式。数据存储和计算都由 BE 节点完成。</p>
<ul>
<li><strong>优点:</strong> 架构简单，运维成本低，数据本地化计算带来极致的查询性能。</li>
<li><strong>缺点:</strong> 扩容时计算和存储资源必须同时扩容，弹性较差。</li>
<li><strong>适用场景:</strong> 私有化部署、对查询性能有极致要求的核心业务、业务负载相对稳定。</li>
</ul>
</li>
<li>
<p><strong>存算分离 (Shared-Data):</strong> 数据存储在远端可靠的对象存储（如 AWS S3, Google GCS, Azure Blob Storage, 或 MinIO）上，计算由独立的 CN 节点完成。</p>
<ul>
<li><strong>优点:</strong> 计算和存储资源可以独立按需扩缩容，弹性极佳，能有效应对业务高峰低谷，降低存储成本。</li>
<li><strong>缺点:</strong> 相比存算一体，由于网络开销，查询性能可能会有一定损耗（但 StarRocks 的热数据缓存机制可以很大程度上缓解此问题）。</li>
<li><strong>适用场景:</strong> 公有云环境、业务负载波动大（有明显潮汐现象）、对弹性要求高的场景、或希望利用廉价对象存储的场景。对于多业务混合且需要严格资源隔离的场景，存算分离模式配合资源组也更具优势。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>最佳实践:</strong> 对于大多数私有化部署场景，建议优先选择<strong>存算一体</strong>模式以获得最佳性能和简化的运维。对于云上部署或需要极致弹性的场景，<strong>存算分离</strong>是更优的选择。本章后续内容主要围绕更通用的存算一体模式展开。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-组件角色">2. 组件角色<a href="#2-组件角色" class="hash-link" aria-label="2. 组件角色的直接链接" title="2. 组件角色的直接链接">​</a></h2>
<p>了解核心组件的职责有助于我们进行更合理的资源配置。</p>
<ul>
<li><strong>Frontend (FE):</strong> FE 节点负责元数据管理、客户端连接管理、查询解析与规划、任务调度等工作。它本身不存储数据，是集群的“大脑”。FE 节点的内存和 CPU 资源主要消耗在元数据管理和查询规划上。</li>
<li><strong>Backend (BE):</strong> 在存算一体模式下，BE 节点负责数据的存储与管理、查询的具体执行、数据导入与导出等工作。它是集群的“主力”，承担了所有的数据处理和 I/O 负载。BE 节点的性能直接决定了整个集群的性能。</li>
<li><strong>Compute Node (CN):</strong> 在存算分离模式下，CN 节点是可选的无状态计算节点，负责执行 SQL 查询。它本身不存储数据，可以根据查询负载进行快速弹性伸缩，从而实现极致的弹性。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-硬件选型">3. 硬件选型<a href="#3-硬件选型" class="hash-link" aria-label="3. 硬件选型的直接链接" title="3. 硬件选型的直接链接">​</a></h2>
<p>硬件选型是集群规划中至关重要的一环。遵循以下建议可以为 StarRocks 提供一个坚实的物理基础。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu">CPU<a href="#cpu" class="hash-link" aria-label="CPU的直接链接" title="CPU的直接链接">​</a></h3>
<p>StarRocks 的查询执行高度依赖 CPU 的向量化计算能力。</p>
<ul>
<li><strong>指令集要求:</strong> <strong>必须</strong>选用支持 <strong>AVX2 指令集</strong> 的 x86-64 架构 CPU。这是保证 StarRocks 高性能运行的硬性要求。</li>
<li><strong>架构选型与性能参考:</strong>
<ul>
<li><strong>Intel / AMD (x86_64):</strong> 主流选择，如 Intel Xeon Gold 系列或 AMD EPYC 系列，性能基准为 100%。</li>
<li><strong>海光 (x86_64):</strong> 国产信创首选，如 7000 系列，支持 AVX2，性能约为 Intel 同级别 CPU 的 70%。</li>
<li><strong>华为鲲鹏 (ARM):</strong> 性能约为 Intel 同级别 CPU 的 60%，且<strong>不支持 AVX2</strong>，需要使用单独编译的 BE 版。</li>
<li><strong>AWS Graviton (ARM):</strong> 如 Graviton3，性能优异，可达 Intel 同级别 CPU 的 100%-114% (StarRocks 3.1+ 版本有专项优化)，需要使用 ARM 版本的安装包。</li>
</ul>
</li>
<li><strong>FE 节点:</strong> 对 CPU 要求相对较低，通常 <strong>8-16 核</strong> 即可满足需求。</li>
<li><strong>BE/CN 节点:</strong> 是计算密集型节点，对 CPU 要求高。推荐 <strong>32-64 核</strong> 的高主频 CPU。核心数越多，并发查询处理能力越强；主频越高，单个查询的计算速度越快。不建议低于 16 核。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="内存">内存<a href="#内存" class="hash-link" aria-label="内存的直接链接" title="内存的直接链  接">​</a></h3>
<p>内存主要用于数据缓存、查询计算以及元数据存储。</p>
<ul>
<li><strong>FE 节点:</strong> 内存消耗主要与元数据规模（库、表、分区、Tablet 的数量）成正比。一个 Tablet 元信息约占 1KB 内存。假设一个集群有 100 万个 Tablet，则元数据约消耗 1GB 内存。<!-- -->
<ul>
<li><strong>通用配置:</strong> 建议 <strong>32 GB</strong> 起步。对于超大规模集群（例如 300 万 Tablet 约需 110GB 内存），建议配置 <strong>128 GB</strong> 或更高，并配合 G1 GC 策略。</li>
</ul>
</li>
<li><strong>BE 节点:</strong> 内存是影响查询性能的关键因素。越大的内存可以缓存越多的热点数据，减少磁盘 I/O，从而大幅提升查询速度。<!-- -->
<ul>
<li><strong>最低配置:</strong> 64 GB。</li>
<li><strong>推荐配置:</strong> 128 GB 或更高。</li>
<li><strong>内存与 CPU 配比:</strong> 推荐内存与 CPU 核数的比例为 <strong>4:1</strong> (例如 32 核 CPU 配 128GB 内存)，最低不应低于 2:1。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="磁盘">磁盘<a href="#磁盘" class="hash-link" aria-label="磁盘的直接链接" title="磁盘的直接链接">​</a></h3>
<p>磁盘是数据持久化存储的地方，其 I/O 性能直接影响数据导入和查询性能。</p>
<ul>
<li><strong>FE 节点:</strong> FE 的元数据存储（BDB JE）对磁盘 I/O 有一定要求，但数据量不大。推荐使用 <strong>SSD</strong> 以获得更快的元数据响应速度，容量 200GB 以上即可。</li>
<li><strong>BE 节点:</strong> BE 节点是 I/O 密集型节点，强烈推荐使用高性能 SSD。<!-- -->
<ul>
<li><strong>类型:</strong> 推荐使用 <strong>NVMe SSD</strong>，其次是普通企业级 SSD。<strong>实时场景严禁在生产环境中使用 HDD (SATA/SAS)</strong>，其缓慢的随机 I/O 会导致查询和写入性能严重下降和系统不稳定。</li>
<li><strong>容量与数量:</strong> 单块磁盘容 量不建议超过 4TB，单 BE 节点挂载 4-6 块盘为宜，以利用多路径 I/O 提升吞吐。</li>
<li><strong>RAID:</strong> <strong>不建议</strong> 使用 RAID。StarRocks 在应用层通过多副本机制保证数据可靠性。使用 JBOD (Just a Bunch of Disks) 模式即可，由 StarRocks 来管理多块磁盘。</li>
<li><strong>性能要求:</strong> 对于有实时更新（尤其是主键模型）的场景，建议使用 <code>fio</code> 等工具测试磁盘性能，确保在混合读写场景下，单盘 IOPS &gt; 2000，吞吐 &gt; 200 MB/s。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="网络">网络<a href="#网络" class="hash-link" aria-label="网络的直接链接" title="网络的直接链接">​</a></h3>
<p>网络负责节点间的数据传输，包括查询执行过程中的数据 shuffle、副本同步等。</p>
<ul>
<li><strong>通用建议:</strong> 推荐使用 <strong>万兆（10 Gbps）或更高</strong> 的网络环境，并确保交换机无阻塞。对于大规模集群或高并发查询场景，25 Gbps 或更高的网络可以有效避免网络成为瓶颈。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="部署环境考量">部署环境考量<a href="#部署环境考量" class="hash-link" aria-label="部署环境考量的直接链接" title="部署环境考量的直接链接">​</a></h3>
<ul>
<li><strong>物理机 vs. 虚拟机/容器:</strong>
<ul>
<li><strong>物理机:</strong> 性能最佳，无虚拟化损耗。</li>
<li><strong>虚拟机 (KVM):</strong> 存在 10%-20% 的性能损耗。</li>
<li><strong>容器 (Kubernetes):</strong> 存在 10%-15% 的性能损耗，主要在网络和存储 I/O。</li>
<li><strong>嵌套部署:</strong> 如果在虚拟机中再运行 K8s，性能损耗会叠加，需谨慎评估。</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-容量评估">4. 容量评估<a href="#4-容量评估" class="hash-link" aria-label="4. 容量评估的直接链接" title="4. 容  量评估的直接链接">​</a></h2>
<p>容量评估是规划的核心，旨在科学地估算出集群所需的节点数量和总存储空间。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-评估输入收集业务与技术指标">4.1 评估输入：收集业务与技术指标<a href="#41-评估输入收集业务与技术指标" class="hash-link" aria-label="4.1 评估输入：收集业务与技术指标的直接链接" title="4.1 评估输入：收集业务与技术指标的直接链接">​</a></h3>
<p>在计算前，请先向业务方收集以下关键信息：</p>
<ul>
<li><strong>业务场景:</strong> BI 报表、Ad-hoc 自助分析、用户画像、CDC 实时同步等。</li>
<li><strong>数据体量:</strong>
<ul>
<li>总历史数据量 (原始格式，如 CSV/Parquet)。</li>
<li>每日新增数据量 (行数或大小)。</li>
<li>数据保留周期 (例如 180 天、365 天)。</li>
</ul>
</li>
<li><strong>查询负载:</strong>
<ul>
<li><strong>查询并发 (QPS):</strong> 高峰期的并发查询数。建议评估连接池模式下的并发数（通常 50 - 100）。</li>
<li><strong>查询复杂度:</strong> 评估典型查询扫描的数据行数，可分为三类：简单查询 ( &lt; 1000 万行)、复杂查询 (1000 - 5000 万行)、重度分析 ( &gt; 5000 万行)。</li>
<li><strong>响应时间要求 (SLA):</strong> 例如 P99 响应时间 &lt; 1s。</li>
<li><strong>负载模式:</strong> 是否有明显的潮汐现象 (如月报、年报导致的高峰)。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-步骤一存储容量评估">4.2 步骤一：存储容量评估<a href="#42-步骤一存储容量评估" class="hash-link" aria-label="4.2 步骤一：存储容量评估的直接链接" title="4.2 步骤一：存储容量评估的直接链接">​</a></h3>
<p><strong>1. 评估参数:</strong></p>
<ul>
<li><strong>数据压缩比:</strong> StarRocks 采用列式存储和多种压缩算法，压缩比通常在 <strong>3:1 到 5:1</strong> 之间 (例如 100GB CSV 导入后约 20-33GB)。保守起见，我们按 <strong>3:1</strong> 估算。</li>
<li><strong>副本数:</strong> 生产环境标准为 <strong>3</strong> 副本。</li>
<li><strong>空间开销系数:</strong> 用于预留索引、元数据、Compaction 和版本迭代的临时空间，通常建议取 <strong>30%</strong> (即 0.3)。</li>
<li><strong>磁盘空间使用率阈值:</strong> 为保证系统稳定和后台任务顺利进行，磁盘使用率不应过高，建议保持在 <strong>70%</strong> 以下。</li>
</ul>
<p><strong>2. 计算步骤:</strong></p>
<ol>
<li><strong>计算总原始数据量:</strong> <code>总原始数据量 = 总历史数据量 + (每日新增数据量 × 数据保留周期)</code></li>
<li><strong>计算压缩后的单副本数据大小:</strong> <code>单副本数据大小 = 总原始数据量 / 数据压缩比</code></li>
<li><strong>计算多副本及开销后的总物理空间:</strong> <code>总物理空间 = 单副本数据大小 × 副本数 × (1 + 空间开销系数)</code></li>
<li><strong>计算集群所需的总磁盘容量:</strong> <code>集群总磁盘容量 = 总物理空间 / 磁盘空间使用率阈值</code></li>
<li><strong>计算所需 BE 节点数:</strong> <code>BE 节点数 = CEILING(集群总磁盘容量 / 单节点磁盘容量)</code> (CEILING 表示向上取整)</li>
</ol>
<p><strong>3. 示例：</strong></p>
<ul>
<li><strong>业务输入:</strong>
<ul>
<li>历史数据: 5 TB</li>
<li>每日新增: 50 GB</li>
<li>保留周期: 365 天</li>
</ul>
</li>
<li><strong>计算过程:</strong>
<ol>
<li>总原始数据量 = <code>5 TB + (50 GB * 365)</code> ≈ <code>5 TB + 17.8 TB</code> = <strong>22.8 TB</strong></li>
<li>单副本大小 = <code>22.8 TB / 3</code> = <strong>7.6 TB</strong></li>
<li>总物理空间 = <code>7.6 TB * 3 * (1 + 0.3)</code> = <strong>29.64 TB</strong></li>
<li>集群总磁盘容量 = <code>29.64 TB / 0.7</code> ≈ <strong>42.34 TB</strong></li>
<li>假设选用单机 8TB 磁盘的 BE 机型，则 BE 节点数 = <code>CEILING(42.34 / 8)</code> = <strong>6 个</strong></li>
</ol>
</li>
</ul>
<p><strong>结论:</strong> 根据存储评估，需要部署 <strong>6 个</strong> BE 节点（每节点配置 8TB SSD）来满足一年的存储需求。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-步骤二计算资源评估">4.3 步骤二：计算资源评估<a href="#43-步骤二计算资源评估" class="hash-link" aria-label="4.3 步骤二：计算资源评估的直接链接" title="4.3 步骤二：计算资源评估的直接链接">​</a></h3>
<p>计算资源的评估比存储更复杂，因为它与查询模式紧密相关。</p>
<ul>
<li><strong>核心关系:</strong> StarRocks 的查询能力与集群总 CPU 核数正相关。增加 BE 节点数量可以线性提升集群的整体服务能力。</li>
<li><strong>QPS 评估的复杂性:</strong> OLAP 场景的 SQL 复杂度差异巨大，无法像 OLTP 那样用简单的公式精确计算 QPS。一个扫描百亿数据的复杂 SQL 和一个点查 SQL 消耗的资源可能有成千上万倍的差距。</li>
<li><strong>实际 QPS vs. 理论 QPS:</strong> 即使对于固定耗时的查询，实际 QPS 也通常低于 <code>并发数 / 平均耗时</code> 的理论值，因为存在调度等待、资源排队等系统开销。</li>
</ul>
<p><strong>评估方法：</strong></p>
<ol>
<li><strong>遵循“先满足存储，再优化计算”原则:</strong> 先根据步骤一计算出满足存储需求的 BE 节点数。</li>
<li><strong>参考模板匹配场景:</strong> 结合下面的《集群体量规格参考模版》，找到与您业务最匹配的场景，以此为基线配置。</li>
<li><strong>上线后验证与调优:</strong> 在系统上线后，通过监控（如 CPU 使用率、查询延迟、<code>fe/log/fe.audit.log</code>）来判断计算资源是否成为瓶颈。如果 CPU 长期处于高位，或查询延迟不达标，应考虑增加 BE 节点。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-步骤三集群体量规格参 考模版">4.4 步骤三：集群体量规格参考模版<a href="#44-步骤三集群体量规格参考模版" class="hash-link" aria-label="4.4 步骤三：集群体量规格参考模版的直接链接" title="4.4 步骤三：集群体量规格参考模版的直接链接">​</a></h3>
<p>下表提供了不同业务场景下的典型配置，可作为您规划的起点。</p>
<table><thead><tr><th style="text-align:left">适用场景</th><th style="text-align:left">固定BI报表</th><th style="text-align:left">实时更新+复杂Adhoc查询</th><th style="text-align:left">实时海量数据摄入 (IoT)</th></tr></thead><tbody><tr><td style="text-align:left"><strong>主要负荷</strong></td><td style="text-align:left">计算密集型</td><td style="text-align:left">计算+IO密集型</td><td style="text-align:left">重度IO密集型</td></tr><tr><td style="text-align:left"><strong>BE 节点数</strong></td><td style="text-align:left">3 ~ 10</td><td style="text-align:left">11 ~ 50</td><td style="text-align:left">100+</td></tr><tr><td style="text-align:left"><strong>单副本热数据</strong></td><td style="text-align:left">&lt; 10TB</td><td style="text-align:left">10 ~ 50TB</td><td style="text-align:left">&lt; 5PB</td></tr><tr><td style="text-align:left"><strong>日增量 (行)</strong></td><td style="text-align:left">千万级</td><td style="text-align:left">千万~百亿级</td><td style="text-align:left">万亿级</td></tr><tr><td style="text-align:left"><strong>FE 节点数</strong></td><td style="text-align:left">3</td><td style="text-align:left">3</td><td style="text-align:left">5+</td></tr><tr><td style="text-align:left"><strong>FE 内存</strong></td><td style="text-align:left">64GB+</td><td style="text-align:left">64~128GB</td><td style="text-align:left">256GB+</td></tr><tr><td style="text-align:left"><strong>BE CPU (核)</strong></td><td style="text-align:left">32+</td><td style="text-align:left">32~96</td><td style="text-align:left">64~96</td></tr><tr><td style="text-align:left"><strong>BE 内存</strong></td><td style="text-align:left">128GB+</td><td style="text-align:left">128~256GB</td><td style="text-align:left">256~512GB</td></tr><tr><td style="text-align:left"><strong>BE 磁盘类型</strong></td><td style="text-align:left">NVMe SSD</td><td style="text-align:left">NVMe SSD</td><td style="text-align:left">NVMe SSD</td></tr><tr><td style="text-align:left"><strong>峰值 QPS</strong></td><td style="text-align:left">10~200</td><td style="text-align:left">200~2k</td><td style="text-align:left">2~10k</td></tr><tr><td style="text-align:left"><strong>P99 简单查询</strong></td><td style="text-align:left">&lt; 1s</td><td style="text-align:left">&lt; 1s</td><td style="text-align:left">&lt; 1s</td></tr><tr><td style="text-align:left"><strong>P99 复杂查询</strong></td><td style="text-align:left">&lt; 10s</td><td style="text-align:left">&lt; 10s</td><td style="text-align:left">&lt; 10s</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-组件部署策略">5. 组件部署策略<a href="#5-组件部署策略" class="hash-link" aria-label="5. 组件部署策略的直接链接" title="5. 组件部署策略的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fe-节点部署">FE 节点部署<a href="#fe-节点部署" class="hash-link" aria-label="FE 节点部署的直接链接" title="FE 节点部署的直接链接">​</a></h3>
<ul>
<li><strong>高可用:</strong> 生产环境<strong>必须</strong>部署 <strong>3 个或以上（奇数个）</strong> FE 节点，以组成一个高可用的集群。1 个 Leader 负责写操作，其他 Follower 负责读操作并作为备份，通过 BDB JE 协议保证元数据一致性。</li>
<li><strong>FE Observer:</strong> 对于读多写少的场景，可以额外部署 FE Observer 节点来扩展查询规划能力和连接数，而不影响 Leader 的选举和写入性能。</li>
<li><strong>物理隔离:</strong> 3 个 FE 节点应部署在不同的物理机或虚拟机上，避免单点物理故障。</li>
<li><strong>资源隔离:</strong> <strong>不建议</strong> 将 FE 与 BE 部署在同一台服务器上，以避免资源争抢。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="be-节点部署">BE 节点部署<a href="#be-节点部署" class="hash-link" aria-label="BE 节点部署的直接链接" title="BE 节点部署的直接链接">​</a></h3>
<ul>
<li><strong>高可用与数量:</strong> 生产环境<strong>至少</strong>需要 <strong>3 个</strong> BE 节点。<strong>推荐部署 4 个或以上</strong>，这样在有一个节点宕机时，集群仍能正常执行 DDL 操作，且副本恢复的压力更小。</li>
<li><strong>物理/机架隔离:</strong> BE 节点应部署在不同的物理机上。如果条件允许，建议进行机架感知（Rack-aware）部署，将不同副本分布在不同机架上，以抵御机架级别的故障。</li>
<li><strong>对等部署:</strong> 所有 BE 节点的硬件配置应保持一致（CPU、内存、磁盘），以避免因“木桶效应”导致部分节点成为性能瓶颈。<strong>禁止</strong>在同一个集群内混合部署 ARM 和 x86 架构的 BE 节点。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-规划清单总结">6. 规划清单总结<a href="#6-规划清单总结" class="hash-link" aria-label="6. 规划清单总结的直接链接" title="6. 规划清单总结的直接链接">​</a></h2>
<p>在完成规划后，请对照以下清单进行检查，确保所有关键点都已考虑周全：</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>部署模式已确定：</strong> 存算一体 vs. 存算分离？</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>业务指标已收集：</strong> 数据量、增长率、QPS 等。</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>硬件配置已选定：</strong> CPU、内存、磁盘、网络、部署环境（物理机/VM/K8s）是否  满足最佳实践要求？</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>存储容量已评估：</strong> BE 节点数量和磁盘容量是否考虑了压缩、副本、开销和预留空间？</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>计算资源已评估：</strong> 当前硬件配置是否能初步满足查询需求？</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>高可用方案已设计：</strong> FE 和 BE 节点数量和部署方式是否满足高可用要求？</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>未来扩展性已考虑：</strong> 当前规划是否为未来 1-2 年的业务增长留有余地？</li>
</ul>
<hr>
<p>周全的集群规划是 StarRocks 项目成功的第一步。希望本章的指南能帮助您构建一个坚实、高效、可扩展的集群基础。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/intro"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">StarRocks 最佳实践指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/deployment"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">部署</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-部署模式选择" class="table-of-contents__link toc-highlight">1. 部署模式选择</a></li><li><a href="#2-组件角色" class="table-of-contents__link toc-highlight">2. 组件角色</a></li><li><a href="#3-硬件选型" class="table-of-contents__link toc-highlight">3. 硬件选型</a><ul><li><a href="#cpu" class="table-of-contents__link toc-highlight">CPU</a></li><li><a href="#内存" class="table-of-contents__link toc-highlight">内存</a></li><li><a href="#磁盘" class="table-of-contents__link toc-highlight">磁盘</a></li><li><a href="#网络" class="table-of-contents__link toc-highlight">网络</a></li><li><a href="#部署环境考量" class="table-of-contents__link toc-highlight">部署环境考量</a></li></ul></li><li><a href="#4-容量评估" class="table-of-contents__link toc-highlight">4. 容量评估</a><ul><li><a href="#41-评估输入收集业务与技术指标" class="table-of-contents__link toc-highlight">4.1 评估输入：收集业务与技术指标</a></li><li><a href="#42-步骤一存储容量评估" class="table-of-contents__link toc-highlight">4.2 步骤一：存储容量评估</a></li><li><a href="#43-步骤二计算资源评估" class="table-of-contents__link toc-highlight">4.3 步骤二：计算资源评估</a></li><li><a href="#44-步骤三集群体量规格参考模版" class="table-of-contents__link toc-highlight">4.4 步骤三：集群体量规格参考模版</a></li></ul></li><li><a href="#5-组件部署策略" class="table-of-contents__link toc-highlight">5. 组件部署策略</a><ul><li><a href="#fe-节点部署" class="table-of-contents__link toc-highlight">FE 节点部署</a></li><li><a href="#be-节点部署" class="table-of-contents__link toc-highlight">BE 节点部署</a></li></ul></li><li><a href="#6-规划清单总结" class="table-of-contents__link toc-highlight">6. 规划清单总结</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>