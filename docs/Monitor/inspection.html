<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Monitor/inspection" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">集群巡检 | StarRocks 最佳实践手册</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://danjing-coder.github.io/docs/Monitor/inspection"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="集群巡检 | StarRocks 最佳实践手册"><meta data-rh="true" name="description" content="定期的集群巡检是保障系统长期稳定运行、提前发现潜在风险的重要手段。一份标准化的巡检清单可以帮助运维人员系统性地检查集群的健康状况，确保所有关键组件和服务都处于正常状态。"><meta data-rh="true" property="og:description" content="定期的集群巡检是保障系统长期稳定运行、提前发现潜在风险的重要手段。一份标准化的巡检清单可以帮助运维人员系统性地检查集群的健康状况，确保所有关键组件和服务都处于正常状态。"><link data-rh="true" rel="canonical" href="https://danjing-coder.github.io/docs/Monitor/inspection"><link data-rh="true" rel="alternate" href="https://danjing-coder.github.io/docs/Monitor/inspection" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://danjing-coder.github.io/docs/Monitor/inspection" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"运维与监控","item":"https://danjing-coder.github.io/docs/Monitor/"},{"@type":"ListItem","position":2,"name":"集群巡检","item":"https://danjing-coder.github.io/docs/Monitor/inspection"}]}</script><link rel="stylesheet" href="/assets/css/styles.c70b19cb.css">
<script src="/assets/js/runtime~main.87fe96bf.js" defer="defer"></script>
<script src="/assets/js/main.def23d9e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">StarRocks 文档</b></a><a class="navbar__item navbar__link" href="/docs/intro">文档</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">intro</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">StarRocks 最佳实践指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/using_starrocks/cluster-planning">最佳实践</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/using_starrocks/cluster-planning">规划与部署</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/using_starrocks">使用与开发</a><button aria-label="展开侧边栏分类 &#x27;使用与开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/Monitor">运维与监控</a><button aria-label="折叠侧边栏分类 &#x27;运维与监控&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Monitor/monitoring">监控告警</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Monitor/logs">日志分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Monitor/inspection">集群巡检</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/troubleshooting">故障处理</a><button aria-label="展开侧边栏分类 &#x27;故障处理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/governance">集群治理</a><button aria-label="展开侧边栏分类 &#x27;集群治理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/maintenance">集群管理</a><button aria-label="展开侧边栏分类 &#x27;集群管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/principles">StarRocks 原理</a><button aria-label="展开侧边栏分类 &#x27;StarRocks 原理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link">最佳实践</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/Monitor"><span>运维与监控</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">集群巡检</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>集群巡检</h1></header>
<p>定期的集群巡检是保障系统长期稳定运行、提前发现潜在风险的重要手段。一份标准化的巡检清单可以帮助运维人员系统性地检查集群的健康状况，确保所有关键组件和服务都处于正常状态。</p>
<p>建议根据集群的重要性和负载情况，执行每日或每周的例行巡检。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-巡检清单">1. 巡检清单<a href="#1-巡检清单" class="hash-link" aria-label="1. 巡检清单的直接链接" title="1. 巡检清单的直接链接">​</a></h2>
<p>本清单涵盖了从集群宏观状态到节点微观指标的各个层面。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-集群整体状态">1.1 集群整体状态<a href="#11-集群整体状态" class="hash-link" aria-label="1.1 集群整体状态的直接链接" title="1.1 集群整体状态的直接链接">​</a></h3>
<table><thead><tr><th style="text-align:left">检查项</th><th style="text-align:left">命令/方法</th><th style="text-align:left">正常状态标准</th><th style="text-align:left">异常处理</th></tr></thead><tbody><tr><td style="text-align:left"><strong>FE 节点状态</strong></td><td style="text-align:left"><code>SHOW FRONTENDS;</code></td><td style="text-align:left">所有节点的 <code>Alive</code> 和 <code>Join</code> 均为 <code>true</code>；有且仅有一个节点的 <code>IsMaster</code> 为 <code>true</code>。</td><td style="text-align:left">检查离线节点的网络和进程，参考故障处理章节。</td></tr><tr><td style="text-align:left"><strong>BE 节点状态</strong></td><td style="text-align:left"><code>SHOW BACKENDS;</code></td><td style="text-align:left">所有节点的 <code>Alive</code> 均为 <code>true</code>。</td><td style="text-align:left">检查离线节点的网络和进程，参考故障处理章节。</td></tr><tr><td style="text-align:left"><strong>BE 节点负载均衡</strong></td><td style="text-align:left"><code>SHOW BACKENDS;</code></td><td style="text-align:left">各个 BE 节点的 <code>TabletNum</code> 数量应大致均衡，差异不应过大（例如超过 20%）。</td><td style="text-align:left">检查 <code>SHOW PROC &#x27;/cluster_balance&#x27;;</code>，确认集群均衡功能正常。</td></tr><tr><td style="text-align:left"><strong>Tablet 健康状态</strong></td><td style="text-align:left"><code>SHOW PROC &#x27;/statistic&#x27;;</code></td><td style="text-align:left"><code>abnormal_tablets_num</code> 的值应为 0。</td><td style="text-align:left">执行 <code>ADMIN SHOW REPLICA STATUS</code> 找到异常副本，并进行修复。</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-节点级别状态-在每个节点上执行">1.2 节点级别状态 (在每个节点上执行)<a href="#12-节点级别状态-在每个节点上执行" class="hash-link" aria-label="1.2 节点级别状态 (在每个节点上执行)的直接链接" title="1.2 节点级别状态 (在每个节点上执行)的直接链接">​</a></h3>
<table><thead><tr><th style="text-align:left">检查项</th><th style="text-align:left">命令/方法</th><th style="text-align:left">正常状态标准</th><th style="text-align:left">异常处理</th></tr></thead><tbody><tr><td style="text-align:left"><strong>FE/BE 进程状态</strong></td><td style="text-align:left"><code>ps -ef | grep starrocks</code></td><td style="text-align:left">能找到 <code>StarRocksFe</code> 或 <code>starrocks_be</code> 进程。</td><td style="text-align:left">检查进程是否被意外终止，查看对应日志排查原因。</td></tr><tr><td style="text-align:left"><strong>FE/BE 端口监听</strong></td><td style="text-align:left"><code>netstat -ntlp</code></td><td style="text-align:left">FE 的 <code>8030</code>, <code>9020</code>, <code>9030</code> 和 BE 的 <code>8040</code>, <code>9050</code>, <code>9060</code> 端口处于 <code>LISTEN</code> 状态。</td><td style="text-align:left">检查进程是否正常启动。</td></tr><tr><td style="text-align:left"><strong>磁盘空间</strong></td><td style="text-align:left"><code>df -h</code></td><td style="text-align:left">所有数据盘的使用率应低于 80%。</td><td style="text-align:left">参考 磁盘空间不足 章节进行处理。</td></tr><tr><td style="text-align:left"><strong>系统负载</strong></td><td style="text-align:left"><code>top</code> 或 <code>uptime</code></td><td style="text-align:left"><code>load average</code> 应远低于 CPU 核数。</td><td style="text-align:left">分析高负载原因，是查询、导入还是 Compaction 导致。</td></tr><tr><td style="text-align:left"><strong>时间同步</strong></td><td style="text-align:left"><code>ntpstat</code> 或 <code>chronyc tracking</code></td><td style="text-align:left">显示 <code>synchronised to</code> 且 <code>offset</code> 很小。</td><td style="text-align:left">检查 NTP 服务是否正常。</td></tr><tr><td style="text-align:left"><strong>日志错误</strong></td><td style="text-align:left"><code>tail -n 500 fe/log/fe.log</code> <br> <code>tail -n 500 be/log/be.INFO</code></td><td style="text-align:left">日志中不应出现持续的 <code>ERROR</code> 或 <code>FATAL</code> 级别的错误。</td><td style="text-align:left">根据错误信息定位具体问题。</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-业务与性能状态">1.3 业务与性能状态<a href="#13-业务与性能状态" class="hash-link" aria-label="1.3 业务与性能状态的直接链接" title="1.3 业务与性能状态的直接链接">​</a></h3>
<table><thead><tr><th style="text-align:left">检查项</th><th style="text-align:left">命令/方法</th><th style="text-align:left">正常状态标准</th><th style="text-align:left">异常处理</th></tr></thead><tbody><tr><td style="text-align:left"><strong>近期导入任务</strong></td><td style="text-align:left"><code>SHOW LOAD ORDER BY CreateTime DESC LIMIT 20;</code></td><td style="text-align:left">近期的导入任务状态应为 <code>FINISHED</code>。</td><td style="text-align:left">关注 <code>CANCELLED</code> 状态的任务，根据 <code>ErrorMsg</code> 排查原因。</td></tr><tr><td style="text-align:left"><strong>Routine Load 状态</strong></td><td style="text-align:left"><code>SHOW ROUTINE LOAD;</code></td><td style="text-align:left">所有 Routine Load 任务的 <code>State</code> 应为 <code>RUNNING</code>。</td><td style="text-align:left">检查 <code>OtherMsg</code> 字段，排查 Kafka 连接或数据质量问题。</td></tr><tr><td style="text-align:left"><strong>Compaction 状态</strong></td><td style="text-align:left">监控 <code>starrocks_be_tablet_max_compaction_score</code> 指标</td><td style="text-align:left">Compaction Score 应保持在较低水平（如 &lt; 100）。</td><td style="text-align:left">分数持续过高说明 Compaction 积压，需优化导入策略或增加资源。</td></tr><tr><td style="text-align:left"><strong>慢查询</strong></td><td style="text-align:left">分析 <code>fe.audit.log</code> 或监控系统</td><td style="text-align:left">不应出现非预期的、耗时过长的查询。</td><td style="text-align:left">使用 <code>Profile</code> 分析慢查询的执行计划，进行 SQL 优化。</td></tr><tr><td style="text-align:left"><strong>表健康度</strong></td><td style="text-align:left"><code>ADMIN CHECK TABLET (tbl_name) PROPERTIES(&quot;type&quot; = &quot;consistency&quot;);</code></td><td style="text-align:left"><code>InconsistentTabletNum</code> 应为 0。</td><td style="text-align:left">找到不一致的副本并使用 <code>ADMIN REPAIR</code> 进行修复。</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-巡检自动化建议">2. 巡检自动化建议<a href="#2-巡 检自动化建议" class="hash-link" aria-label="2. 巡检自动化建议的直接链接" title="2. 巡检自动化建议的直接链接">​</a></h2>
<p>手动的例行巡检耗时耗力且容易遗漏。我们强烈建议将核心巡检项自动化，通过脚本定期执行，并将结果汇总成报告。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-自动化脚本">2.1 自动化脚本<a href="#21-自动化脚本" class="hash-link" aria-label="2.1 自动化脚本的直接链接" title="2.1 自动化脚本的直接链接">​</a></h3>
<p>为了更高效、更全面地进行巡检，我们提供了多个自动化脚本，以满足不同场景的需求。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-快速概览脚本-starrocks-doctorpy">2.1.1 快速概览脚本 (<code>starrocks-doctor.py</code>)<a href="#211-快速概览脚本-starrocks-doctorpy" class="hash-link" aria-label="211-快速概览脚本-starrocks-doctorpy的直接链接" title="211-快速概览脚本-starrocks-doctorpy的直接链接">​</a></h4>
<p><code>starrocks-doctor.py</code> 脚本可以连接到集群，自动执行<strong>集群整体状态</strong>的大部分核心检查项，并以清晰的表格形式在命令行中输出巡检报告，高亮显示异常指标，适合快速概览和集成到自动化运维流程中。</p>
<p>该脚本主要覆盖了巡检清单中 &quot;1.1 集群整体状态&quot; 的核心内容，包括：</p>
<ul>
<li><strong>FE/BE 节点状态:</strong> 检查所有节点的 <code>Alive</code> 状态。</li>
<li><strong>BE 节点磁盘健康与均衡:</strong> 检查每个 BE 节点的磁盘使用率、总 Tablet 数量，并计算 Tablet 数量的均衡度（标准差）。</li>
<li><strong>Tablet 健康状态:</strong> 检查集群中是否存在状态异常的 Tablet。</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明">使用说明<a href="#使用说明" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<ol>
<li>
<p><strong>下载脚本</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://raw.githubusercontent.com/DanJing-coder/database-tools/main/starrocks/starrocks-doctor.py</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>安装依赖</strong>
脚本依赖 <code>PyMySQL</code> 和 <code>prettytable</code> 库。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip3 install PyMySQL prettytable</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>授予执行权限</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x starrocks-doctor.py</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>运行脚本</strong>
执行脚本并传入 FE 的连接信息。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3 starrocks-doctor.py --fe_host &lt;your_fe_host&gt; --fe_query_port 9030 --user &lt;your_user&gt; --password &lt;your_password&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>定时执行 (Crontab)</strong>
可以将巡检脚本加入到 <code>crontab</code> 中，实现每日自动巡检，并将报告输出到日志文件。</p>
<div class="language-crontab codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-crontab codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 每天上午 9 点执行巡检</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 9 * * * /usr/bin/python3 /path/to/starrocks-doctor.py --fe_host ... &gt;&gt; /path/to/logs/sr_check.log 2&gt;&amp;1</span><br></span></code></pre></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例输出">示例输出<a href="#示例输出" class="hash-link" aria-label="示例输出的直接链接" title="示例输出的直接链接">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">*************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* StarRocks Cluster Health Check Report *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* Time: 2023-11-22 10:00:00           *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== Frontend Status ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-----------------+----------+...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Name          | IP              | Role     |...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-----------------+----------+...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| starrocks-fe1 | 192.168.1.1     | FOLLOWER |...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-----------------+----------+...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[OK] All FE nodes are alive.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== Backend Status ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+-----------+-----------------+-------+...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| BackendId | Host            | Alive |...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+-----------+-----------------+-------+...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| 10001     | 192.168.1.1     | true  |...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+-----------+-----------------+-------+...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[OK] All BE nodes are alive.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-集成到监控系统">2.2 集成到监控系统<a href="#22-集成到监控系统" class="hash-link" aria-label="2.2 集成到监控系统的直接链接" title="2.2 集成到监控系统的直接链接">​</a></h3>
<p>更专业的做法是将巡检逻辑集成到现有的监控告警体系中。</p>
<ul>
<li><strong>Prometheus:</strong> 可以使用 <code>blackbox_exporter</code> 来探测 FE/BE 的 HTTP 端口，或使用 <code>mysqld_exporter</code> 的自定义查询功能来执行 <code>SHOW</code> 命令，并将结果转换为 Prometheus 指标。</li>
<li><strong>Zabbix/Nagios:</strong> 可以将上述 Shell 脚本作为自定义监控项，由 Zabbix Agent 定期执行并上报结果。</li>
</ul>
<p>通过自动化巡检，可以极大地提升运维效率，将被动响应故障转变为主动发现和预防问题。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Monitor/logs"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">日志分析</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/troubleshooting"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">故障处理</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-巡检清单" class="table-of-contents__link toc-highlight">1. 巡检清单</a><ul><li><a href="#11-集群整体状态" class="table-of-contents__link toc-highlight">1.1 集群整体状态</a></li><li><a href="#12-节点级别状态-在每个节点上执行" class="table-of-contents__link toc-highlight">1.2 节点级别状态 (在每个节点上执行)</a></li><li><a href="#13-业务与性能状态" class="table-of-contents__link toc-highlight">1.3 业务与性能状态</a></li></ul></li><li><a href="#2-巡检自动化建议" class="table-of-contents__link toc-highlight">2. 巡检自动化建议</a><ul><li><a href="#21-自动化脚本" class="table-of-contents__link toc-highlight">2.1 自动化脚本</a></li><li><a href="#22-集成到监控系统" class="table-of-contents__link toc-highlight">2.2 集成到监控系统</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>