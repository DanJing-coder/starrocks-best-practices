"use strict";(self.webpackChunkstarrocks_best_practices=self.webpackChunkstarrocks_best_practices||[]).push([[6634],{7331:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Monitor/monitoring","title":"\u76d1\u63a7\u544a\u8b66","description":"\u4e00\u4e2a\u6ca1\u6709\u76d1\u63a7\u7684\u7cfb\u7edf\u662f\u5371\u9669\u7684\uff0c\u5bf9\u4e8e\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u66f4\u662f\u5982\u6b64\u3002\u5efa\u7acb\u4e00\u5957\u5b8c\u5584\u7684\u76d1\u63a7\u544a\u8b66\u4f53\u7cfb\uff0c\u662f\u4fdd\u969c StarRocks \u96c6\u7fa4\u957f\u671f\u7a33\u5b9a\u8fd0\u884c\u3001\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\u7684\u57fa\u77f3\u3002","source":"@site/docs/Monitor/monitoring.md","sourceDirName":"Monitor","slug":"/Monitor/monitoring","permalink":"/docs/Monitor/monitoring","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u8fd0\u7ef4\u4e0e\u76d1\u63a7","permalink":"/docs/Monitor/"},"next":{"title":"\u65e5\u5fd7\u5206\u6790","permalink":"/docs/Monitor/logs"}}');var s=t(4848),i=t(8453);const l={},a="\u76d1\u63a7\u544a\u8b66",o={},c=[{value:"1. \u76d1\u63a7\u67b6\u6784",id:"1-\u76d1\u63a7\u67b6\u6784",level:2},{value:"2. \u90e8\u7f72\u4e0e\u914d\u7f6e",id:"2-\u90e8\u7f72\u4e0e\u914d\u7f6e",level:2},{value:"\u6b65\u9aa4\u4e00\uff1a\u66b4\u9732 StarRocks \u6307\u6807",id:"\u6b65\u9aa4\u4e00\u66b4\u9732-starrocks-\u6307\u6807",level:3},{value:"\u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e Prometheus",id:"\u6b65\u9aa4\u4e8c\u914d\u7f6e-prometheus",level:3},{value:"\u6b65\u9aa4\u4e09\uff1a\u914d\u7f6e Grafana",id:"\u6b65\u9aa4\u4e09\u914d\u7f6e-grafana",level:3},{value:"3. \u6838\u5fc3\u6307\u6807\u4e0e\u544a\u8b66\u89c4\u5219",id:"3-\u6838\u5fc3\u6307\u6807\u4e0e\u544a\u8b66\u89c4\u5219",level:2},{value:"3.1 \u6838\u5fc3\u76d1\u63a7\u6307\u6807",id:"31-\u6838\u5fc3\u76d1\u63a7\u6307\u6807",level:3},{value:"\u8282\u70b9\u4e0e\u670d\u52a1\u53ef\u7528\u6027",id:"\u8282\u70b9\u4e0e\u670d\u52a1\u53ef\u7528\u6027",level:4},{value:"\u8d44\u6e90\u4f7f\u7528\u7387",id:"\u8d44\u6e90\u4f7f\u7528\u7387",level:4},{value:"\u67e5\u8be2\u4e0e\u8fde\u63a5",id:"\u67e5\u8be2\u4e0e\u8fde\u63a5",level:4},{value:"\u5bfc\u5165\u4e0e Compaction",id:"\u5bfc\u5165\u4e0e-compaction",level:4},{value:"3.2 \u544a\u8b66\u89c4\u5219\u793a\u4f8b",id:"32-\u544a\u8b66\u89c4\u5219\u793a\u4f8b",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u76d1\u63a7\u544a\u8b66",children:"\u76d1\u63a7\u544a\u8b66"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u4e2a\u6ca1\u6709\u76d1\u63a7\u7684\u7cfb\u7edf\u662f\u5371\u9669\u7684\uff0c\u5bf9\u4e8e\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u66f4\u662f\u5982\u6b64\u3002\u5efa\u7acb\u4e00\u5957\u5b8c\u5584\u7684\u76d1\u63a7\u544a\u8b66\u4f53\u7cfb\uff0c\u662f\u4fdd\u969c StarRocks \u96c6\u7fa4\u957f\u671f\u7a33\u5b9a\u8fd0\u884c\u3001\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\u7684\u57fa\u77f3\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["StarRocks \u81ea\u8eab\u901a\u8fc7 HTTP \u63a5\u53e3\u66b4\u9732\u4e86\u4e30\u5bcc\u7684\u6027\u80fd\u6307\u6807\uff08Metrics\uff09\uff0c\u8fd9\u4e9b\u6307\u6807\u9075\u5faa Prometheus \u7684\u6807\u51c6\u683c\u5f0f\u3002\u56e0\u6b64\uff0c\u4e1a\u754c\u6700\u4e3b\u6d41\u7684\u76d1\u63a7\u65b9\u6848 ",(0,s.jsx)(n.strong,{children:"Prometheus + Grafana + Alertmanager"})," \u53ef\u4ee5\u4e0e StarRocks \u65e0\u7f1d\u96c6\u6210\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"1-\u76d1\u63a7\u67b6\u6784",children:"1. \u76d1\u63a7\u67b6\u6784"}),"\n",(0,s.jsx)(n.p,{children:"\u63a8\u8350\u7684\u76d1\u63a7\u67b6\u6784\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TD\n    subgraph StarRocks Cluster\n        FE1["FE 1<br />(:8030/metrics)"] & FE2["FE 2<br />(:8030/metrics)"] & FE3["FE 3<br />(:8030/metrics)"]\n        BE1["BE 1<br />(:8040/metrics)"] & BE2["BE 2<br />(:8040/metrics)"] & BE3["BE 3<br />(:8040/metrics)"]\n    end\n\n    subgraph Monitoring Stack\n        P[Prometheus] --\x3e G[Grafana]\n        P --\x3e AM[Alertmanager]\n    end\n\n    FE1 -- Scrape Metrics --\x3e P\n    FE2 -- Scrape Metrics --\x3e P\n    FE3 -- Scrape Metrics --\x3e P\n    BE1 -- Scrape Metrics --\x3e P\n    BE2 -- Scrape Metrics --\x3e P\n    BE3 -- Scrape Metrics --\x3e P\n\n    AM -- Sends Alerts --\x3e Ops[DBA/SRE]\n    Ops -- Views Dashboards --\x3e G'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Prometheus:"})," \u5b9a\u671f\u4ece StarRocks \u7684 FE \u548c BE \u8282\u70b9\u62c9\u53d6\uff08Scrape\uff09\u6307\u6807\u6570\u636e\u5e76\u5b58\u50a8\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Grafana:"})," \u5c06 Prometheus \u4e2d\u7684\u6570\u636e\u4ee5\u56fe\u8868\u7684\u5f62\u5f0f\u53ef\u89c6\u5316\uff0c\u63d0\u4f9b\u76d1\u63a7\u5927\u76d8\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Alertmanager:"})," \u63a5\u6536 Prometheus \u63a8\u9001\u7684\u544a\u8b66\u89c4\u5219\uff0c\u5e76\u8d1f\u8d23\u5c06\u544a\u8b66\u4fe1\u606f\u901a\u8fc7\u90ae\u4ef6\u3001\u5fae\u4fe1\u3001\u9489\u9489\u7b49\u65b9\u5f0f\u53d1\u9001\u7ed9\u8fd0\u7ef4\u4eba\u5458\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"2-\u90e8\u7f72\u4e0e\u914d\u7f6e",children:"2. \u90e8\u7f72\u4e0e\u914d\u7f6e"}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4\u4e00\u66b4\u9732-starrocks-\u6307\u6807",children:"\u6b65\u9aa4\u4e00\uff1a\u66b4\u9732 StarRocks \u6307\u6807"}),"\n",(0,s.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cStarRocks \u7684\u6307\u6807\u66b4\u9732\u529f\u80fd\u662f\u5f00\u542f\u7684\u3002\u8bf7\u786e\u4fdd\u4ee5\u4e0b\u914d\u7f6e\u9879\u4e3a ",(0,s.jsx)(n.code,{children:"true"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"FE:"})," ",(0,s.jsx)(n.code,{children:"fe/conf/fe.conf"})," -> ",(0,s.jsx)(n.code,{children:"enable_metric_calculator = true"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BE:"})," ",(0,s.jsx)(n.code,{children:"be/conf/be.conf"})," -> ",(0,s.jsx)(n.code,{children:"enable_metric_calculator = true"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u60a8\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u4ee5\u4e0b\u5730\u5740\u6765\u9a8c\u8bc1\u6307\u6807\u662f\u5426\u6b63\u5e38\u66b4\u9732\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["FE \u6307\u6807: ",(0,s.jsx)(n.code,{children:"`http://<fe_ip>:8030/metrics`"})]}),"\n",(0,s.jsxs)(n.li,{children:["BE \u6307\u6807: ",(0,s.jsx)(n.code,{children:"`http://<be_ip>:8040/metrics`"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4\u4e8c\u914d\u7f6e-prometheus",children:"\u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e Prometheus"}),"\n",(0,s.jsxs)(n.p,{children:["\u4fee\u6539 Prometheus \u7684\u4e3b\u914d\u7f6e\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"prometheus.yml"}),"\uff0c\u6dfb\u52a0\u6293\u53d6 StarRocks \u6307\u6807\u7684\u4efb\u52a1\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# prometheus.yml\nglobal:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: 'starrocks_fe'\n    static_configs:\n      - targets: ['192.168.1.1:8030', '192.168.1.2:8030', '192.168.1.3:8030']\n\n  - job_name: 'starrocks_be'\n    static_configs:\n      - targets: ['192.168.1.1:8040', '192.168.1.2:8040', '192.168.1.3:8040']\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542f Prometheus \u670d\u52a1\u3002\u7a0d\u540e\u5728 Prometheus UI \u7684 ",(0,s.jsx)(n.code,{children:"Targets"})," \u9875\u9762\uff0c\u60a8\u5e94\u8be5\u80fd\u770b\u5230\u6240\u6709 StarRocks \u8282\u70b9\u7684\u72b6\u6001\u4e3a ",(0,s.jsx)(n.code,{children:"UP"}),"\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4\u4e09\u914d\u7f6e-grafana",children:"\u6b65\u9aa4\u4e09\uff1a\u914d\u7f6e Grafana"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6dfb\u52a0\u6570\u636e\u6e90:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u767b\u5f55 Grafana\uff0c\u8fdb\u5165 ",(0,s.jsx)(n.code,{children:"Configuration"})," -> ",(0,s.jsx)(n.code,{children:"Data Sources"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u70b9\u51fb ",(0,s.jsx)(n.code,{children:"Add data source"}),"\uff0c\u9009\u62e9 ",(0,s.jsx)(n.code,{children:"Prometheus"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5728 ",(0,s.jsx)(n.code,{children:"HTTP"})," -> ",(0,s.jsx)(n.code,{children:"URL"})," \u5b57\u6bb5\u4e2d\uff0c\u586b\u5165 Prometheus \u7684\u5730\u5740\uff08\u5982 ",(0,s.jsx)(n.code,{children:"http://localhost:9090"}),"\uff09\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u70b9\u51fb ",(0,s.jsx)(n.code,{children:"Save & test"}),"\uff0c\u63d0\u793a\u6210\u529f\u5373\u53ef\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u5bfc\u5165\u5b98\u65b9 Dashboard:"}),"\nStarRocks \u5b98\u65b9\u63d0\u4f9b\u4e86\u529f\u80fd\u5b8c\u5584\u7684 Grafana Dashboard \u6a21\u677f\u3002"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u8fdb\u5165 ",(0,s.jsx)(n.code,{children:"Dashboards"})," -> ",(0,s.jsx)(n.code,{children:"Import"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5728 ",(0,s.jsx)(n.code,{children:"Import via grafana.com"})," \u5b57\u6bb5\u4e2d\uff0c\u8f93\u5165\u5b98\u65b9 Dashboard \u7684 ID\u3002","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"StarRocks Overview Dashboard:"})," ",(0,s.jsx)(n.code,{children:"15978"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"StarRocks BE Detail Dashboard:"})," ",(0,s.jsx)(n.code,{children:"15979"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u70b9\u51fb ",(0,s.jsx)(n.code,{children:"Load"}),"\uff0c\u9009\u62e9\u60a8\u521a\u521a\u914d\u7f6e\u7684 Prometheus \u6570\u636e\u6e90\uff0c\u7136\u540e\u70b9\u51fb ",(0,s.jsx)(n.code,{children:"Import"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5bfc\u5165\u540e\uff0c\u60a8\u5c31\u53ef\u4ee5\u770b\u5230 StarRocks \u96c6\u7fa4\u7684\u6574\u4f53\u6982\u89c8\u548c\u5404\u4e2a\u8282\u70b9\u7684\u8be6\u7ec6\u6307\u6807\u4e86\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"3-\u6838\u5fc3\u6307\u6807\u4e0e\u544a\u8b66\u89c4\u5219",children:"3. \u6838\u5fc3\u6307\u6807\u4e0e\u544a\u8b66\u89c4\u5219"}),"\n",(0,s.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u4e00\u4e9b\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u7684\u6838\u5fc3\u6307\u6807\u548c\u5efa\u8bae\u7684\u544a\u8b66\u89c4\u5219\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"31-\u6838\u5fc3\u76d1\u63a7\u6307\u6807",children:"3.1 \u6838\u5fc3\u76d1\u63a7\u6307\u6807"}),"\n",(0,s.jsx)(n.h4,{id:"\u8282\u70b9\u4e0e\u670d\u52a1\u53ef\u7528\u6027",children:"\u8282\u70b9\u4e0e\u670d\u52a1\u53ef\u7528\u6027"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u6307\u6807\u540d\u79f0"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7ec4\u4ef6"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"up"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE/BE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8282\u70b9\u5b58\u6d3b\u72b6\u6001 (1=\u5b58\u6d3b, 0=\u5b95\u673a)\uff0c\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u6307\u6807\u3002"})]})})]}),"\n",(0,s.jsx)(n.h4,{id:"\u8d44\u6e90\u4f7f\u7528\u7387",children:"\u8d44\u6e90\u4f7f\u7528\u7387"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u6307\u6807\u540d\u79f0"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7ec4\u4ef6"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_be_cpu"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE \u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u7387\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_be_process_mem_bytes"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE \u8fdb\u7a0b\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:'jvm_heap_size_bytes{type="used"}'})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE \u8282\u70b9\u7684 JVM \u5df2\u7528\u5806\u5185\u5b58\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_be_disks_data_used_bytes"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE \u8282\u70b9\u4e0a\u6570\u636e\u76d8\u7684\u5df2\u7528\u7a7a\u95f4\u3002"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u67e5\u8be2\u4e0e\u8fde\u63a5",children:"\u67e5\u8be2\u4e0e\u8fde\u63a5"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u6307\u6807\u540d\u79f0"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7ec4\u4ef6"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_fe_qps"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6bcf\u79d2\u67e5\u8be2\u6570 (QPS)\uff0c\u53cd\u6620\u67e5\u8be2\u8d1f\u8f7d\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_fe_query_latency_ms"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u67e5\u8be2\u5ef6\u8fdf\u7684\u5206\u5e03\uff0c\u901a\u5e38\u5173\u6ce8 P95/P99 \u5206\u4f4d\u6570\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_fe_query_err_rate"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u67e5\u8be2\u9519\u8bef\u7387\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_fe_connection_total"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE \u4e0a\u7684\u603b\u8fde\u63a5\u6570\u3002"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u5bfc\u5165\u4e0e-compaction",children:"\u5bfc\u5165\u4e0e Compaction"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u6307\u6807\u540d\u79f0"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u7ec4\u4ef6"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_fe_txn_failed"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5bfc\u5165\u4e8b\u52a1\u5931\u8d25\u603b\u6570\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_fe_txn_running"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"FE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u6b63\u5728\u8fd0\u884c\u7684\u5bfc\u5165\u4e8b\u52a1\u6570\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_be_tablet_max_compaction_score"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5355\u4e2a BE \u8282\u70b9\u4e0a\u6240\u6709 Tablet \u7684\u6700\u5927 Compaction Score\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"starrocks_be_max_tablet_rowset_num"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"BE"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u5355\u4e2a BE \u8282\u70b9\u4e0a\u5355\u4e2a Tablet \u7684\u6700\u5927 Rowset \u6570\u91cf\u3002"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"32-\u544a\u8b66\u89c4\u5219\u793a\u4f8b",children:"3.2 \u544a\u8b66\u89c4\u5219\u793a\u4f8b"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 Prometheus \u7684\u89c4\u5219\u6587\u4ef6\uff08\u5982 ",(0,s.jsx)(n.code,{children:"alert.rules.yml"}),"\uff09\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u89c4\u5219\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: starrocks-alerts\n    rules:\n\n      # ---  \u670d\u52a1\u6302\u8d77\u7c7b\u544a\u8b66 ---\n      - alert: StarRocks_FEServiceSuspension\n        expr: count(up{group="fe", job="$job_name"}) < $min_fe_count\n        for: 5m\n        labels:\n          severity: critical\n          category: availability\n        annotations:\n          summary: "FE \u670d\u52a1\u6302\u8d77\u544a\u8b66"\n          description: "FE \u8282\u70b9\u6570\u91cf\u5c11\u4e8e\u9884\u8bbe\u503c\uff08<$min_fe_count\uff09\uff0c\u5f53\u524d\u4ec5\u6709 {{ $value }} \u4e2a\u5728\u7ebf\u8282\u70b9\u3002"\n\n      - alert: StarRocks_BEServiceSuspension\n        expr: node_info{type="be_node_num", job="$job_name", state="dead"} > 1\n        for: 5m\n        labels:\n          severity: critical\n          category: availability\n        annotations:\n          summary: "BE \u670d\u52a1\u6302\u8d77\u544a\u8b66"\n          description: "\u8d85\u8fc7 1 \u4e2a BE \u8282\u70b9\u6302\u8d77\uff0c\u8bf7\u68c0\u67e5\u5e76\u5c1d\u8bd5\u91cd\u542f\u8fd9\u4e9b BE \u8282\u70b9\u3002"\n\n      # ---  \u8d44\u6e90\u8d1f\u8f7d\u7c7b\u544a\u8b66 ---\n      - alert: StarRocks_BEHighCPUUsage\n        expr: (1 - (sum(rate(starrocks_be_cpu{mode="idle", job="$job_name"}[5m])) by (instance)) / (sum(rate(starrocks_be_cpu{job="$job_name"}[5m])) by (instance))) * 100 > 90\n        for: 5m\n        labels:\n          severity: warning\n          category: performance\n        annotations:\n          summary: "BE CPU \u4f7f\u7528\u7387\u8fc7\u9ad8"\n          description: "BE CPU \u5229\u7528\u7387\u8d85\u8fc7 90%\uff0c\u53ef\u80fd\u5b58\u5728\u5927\u67e5\u8be2\u6216\u52a0\u8f7d\u4efb\u52a1\u5360\u7528\u8d44\u6e90\u3002\u5efa\u8bae\u4f7f\u7528 top \u6216 perf \u5206\u6790\u8fdb\u7a0b\u74f6\u9888\u3002"\n\n      - alert: StarRocks_BEMemoryHighUsage\n        expr: (1 - node_memory_MemAvailable_bytes{instance=~".*"} / node_memory_MemTotal_bytes{instance=~".*"}) * 100 > 90\n        for: 5m\n        labels:\n          severity: warning\n          category: performance\n        annotations:\n          summary: "BE \u5185\u5b58\u4f7f\u7528\u8fc7\u9ad8"\n          description: "\u7cfb\u7edf\u5185\u5b58\u4f7f\u7528\u8d85\u8fc7 90%\uff0c\u5982\u65e0\u6709\u6548\u91ca\u653e\u65b9\u5f0f\uff0c\u53ef\u5c1d\u8bd5\u91cd\u542f BE \u8282\u70b9\u3002"\n\n      - alert: StarRocks_DiskIOLoadHigh\n        expr: rate(node_disk_io_time_seconds_total{instance=~".*"}[1m]) * 100 > 90\n        for: 5m\n        labels:\n          severity: warning\n          category: performance\n        annotations:\n          summary: "\u78c1\u76d8 I/O \u8d1f\u8f7d\u8fc7\u9ad8"\n          description: "\u78c1\u76d8 I/O \u65f6\u95f4\u5360\u6bd4\u8d85\u8fc7 90%\u3002\u8bf7\u4f7f\u7528 iotop \u6216 ADMIN EXECUTE \u67e5\u8be2\u9ad8 I/O tablet\u3002"\n\n      - alert: StarRocks_RootFS_FreeLow\n        expr: node_filesystem_free_bytes{mountpoint="/"} / 1024 / 1024 / 1024 < 5\n        for: 10m\n        labels:\n          severity: warning\n          category: disk-space\n        annotations:\n          summary: "\u6839\u76ee\u5f55\u5269\u4f59\u5bb9\u91cf\u4e0d\u8db3"\n          description: "\u6839\u76ee\u5f55\u5269\u4f59\u7a7a\u95f4\u5c0f\u4e8e 5 GB\uff0c\u8bf7\u6e05\u7406 /var\u3001/opt\u3001/tmp \u7b49\u76ee\u5f55\u3002"\n\n      - alert: StarRocks_DataDiskUsageHigh\n        expr: (sum(starrocks_be_disks_total_capacity{job="$job"}) by (host, path) - sum(starrocks_be_disks_avail_capacity{job="$job"}) by (host, path)) / sum(starrocks_be_disks_total_capacity{job="$job"}) by (host, path) * 100 > 90\n        for: 10m\n        labels:\n          severity: warning\n          category: disk-space\n        annotations:\n          summary: "\u6570\u636e\u76d8\u4f7f\u7528\u7387\u8fc7\u9ad8"\n          description: "\u6570\u636e\u76d8\u4f7f\u7528\u7387\u8d85\u8fc7 90%\u3002\u8bf7\u68c0\u67e5\u662f\u5426\u6709\u5927\u91cf\u6570\u636e\u52a0\u8f7d\u6216 DROP \u64cd\u4f5c\u672a\u5237\u65b0\u3002"\n\n      - alert: StarRocks_FEMetadataDiskLow\n        expr: node_filesystem_free_bytes{mountpoint="${meta_path}"} / 1024 / 1024 / 1024 < 10\n        for: 10m\n        labels:\n          severity: warning\n          category: disk-space\n        annotations:\n          summary: "FE \u5143\u6570\u636e\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3"\n          description: "FE metadata \u8def\u5f84\u5269\u4f59\u7a7a\u95f4\u5c0f\u4e8e 10 GB\uff0c\u53ef\u80fd\u56e0 bdb checkpoint \u5931\u8d25\u5bfc\u81f4\u3002\u68c0\u67e5\u5e76\u6e05\u7406 metadata \u6587\u4ef6\u3002"\n\n      # ---  \u96c6\u7fa4\u670d\u52a1\u5f02\u5e38 ---\n      - alert: StarRocks_CompactionFailure\n        expr: increase(starrocks_be_engine_requests_total{job="$job_name", status="failed", type=~"cumulative_compaction|base_compaction"}[1m]) > 3\n        for: 1m\n        labels:\n          severity: warning\n          category: cluster-health\n        annotations:\n          summary: "Compaction \u5931\u8d25\u544a\u8b66"\n          description: "\u6700\u8fd1 1 \u5206\u949f compaction\uff08\u7d2f\u79ef\u6216\u57fa\u7840\uff09\u5931\u8d25\u6b21\u6570\u8d85\u8fc7 3 \u6b21\u3002\u8bf7\u6839\u636e\u65e5\u5fd7\u5206\u6790\u76f8\u5173 tablet \u5e76\u8003\u8651\u89e6\u53d1 Clone\u3002"\n\n      - alert: StarRocks_HighCompactionPressure\n        expr: starrocks_fe_max_tablet_compaction_score{job="$job_name", instance="$fe_leader"} > 100\n        for: 5m\n        labels:\n          severity: warning\n          category: cluster-health\n        annotations:\n          summary: "Compaction \u538b\u529b\u8fc7\u9ad8"\n          description: "FE leader \u4e0a\u7684\u6700\u9ad8 compaction score \u8d85\u8fc7 100\u3002\u5efa\u8bae\u964d\u4f4e\u52a0\u8f7d/DELETE \u9891\u7387\u6216\u8c03\u6574 pipeline_dop\u3002"\n\n      - alert: StarRocks_ExcessiveRowsetVersions\n        expr: starrocks_be_max_tablet_rowset_num{job="$job_name"} > 700\n        for: 5m\n        labels:\n          severity: warning\n          category: cluster-health\n        annotations:\n          summary: "Tablet \u7248\u672c\u6570\u8fc7\u591a"\n          description: "BE \u4e0a\u5b58\u5728 tablet \u7684 rowset \u6570\u8d85\u8fc7 700\u3002\u8bf7\u5b9a\u4f4d tablet \u5e76\u8003\u8651 clone \u6216\u8c03\u6574\u7248\u672c\u9650\u5236\u3002"\n\n      - alert: StarRocks_CheckPointFailure\n        expr: starrocks_fe_meta_log_count{job="$job_name", instance="$fe_master"} > 100000\n        for: 5m\n        labels:\n          severity: warning\n          category: metadata\n        annotations:\n          summary: "Checkpoint \u5931\u8d25\u544a\u8b66"\n          description: "FE BDB \u65e5\u5fd7\u8ba1\u6570\u8d85\u8fc7 100,000\uff0cCheckpoint \u53ef\u80fd\u672a\u6267\u884c\uff0c\u8bf7\u68c0\u67e5 FE \u65e5\u5fd7\u786e\u8ba4 checkpoint \u6d41\u7a0b\u3002"\n\n      - alert: StarRocks_FEThreadCountHigh\n        expr: starrocks_fe_thread_pool{job="$job_name", type!="completed_task_count"} > 3000\n        for: 5m\n        labels:\n          severity: warning\n          category: performance\n        annotations:\n          summary: "FE \u7ebf\u7a0b\u6570\u5f02\u5e38\u504f\u9ad8"\n          description: "FE \u7ebf\u7a0b\u6570\u8d85\u8fc7 3000\uff0c\u53ef\u80fd\u4e3a UNION ALL \u67e5\u8be2\u8fc7\u591a\u6216 pipeline_dop \u8bbe\u7f6e\u4e0d\u5408\u7406\u3002"\n\n      - alert: StarRocks_FEJVMUsageHigh\n        expr: sum(jvm_heap_size_bytes{job="$job_name", type="used"}) * 100 / sum(jvm_heap_size_bytes{job="$job_name", type="max"}) > 90\n        for: 5m\n        labels:\n          severity: warning\n          category: performance\n        annotations:\n          summary: "FE JVM \u5185\u5b58\u4f7f\u7528\u7387\u8d85\u8fc7 90%"\n          description: "FE JVM \u5185\u5b58\u5360\u7528\u8fc7\u9ad8\u3002\u5efa\u8bae\u6536\u96c6 jmap\uff0c\u5e76\u8003\u8651\u589e\u52a0 Xmx \u540e\u91cd\u542f\u3002"\n\n      # ---  \u67e5\u8be2 & \u52a0\u8f7d\u7c7b\u5f02\u5e38 ---\n      - alert: StarRocks_LoadingFailureRateHigh\n        expr: rate(starrocks_fe_txn_failed{job="$job_name", instance="$fe_master"}[5m]) * 100 > 5\n        for: 5m\n        labels:\n          severity: warning\n          category: loading\n        annotations:\n          summary: "\u52a0\u8f7d\u4e8b\u52a1\u5931\u8d25\u7387\u9ad8"\n          description: "\u52a0\u8f7d\u4efb\u52a1\u5931\u8d25\u7387\u8d85\u8fc7 5%\u3002\u8bf7\u68c0\u67e5 FE \u65e5\u5fd7\u4e2d status: ABORTED \u76f8\u5173\u5185\u5bb9\u3002"\n\n      - alert: StarRocks_LoadingTxnCountHigh\n        expr: sum(starrocks_fe_txn_running{job="$job_name"}) by (db) > 900\n        for: 5m\n        labels:\n          severity: warning\n          category: loading\n        annotations:\n          summary: "\u5355\u5e93\u52a0\u8f7d\u4e8b\u52a1\u6570\u8fc7\u591a"\n          description: "\u5355\u4e2a\u6570\u636e\u5e93\u52a0\u8f7d\u4e8b\u52a1\u6570\u8d85\u8fc7 900\u3002\u53ef\u4e34\u65f6\u63d0\u5347\u9650\u5236\u6216\u4f18\u5316\u52a0\u8f7d\u9891\u7387\u3002"\n\n      - alert: StarRocks_QueryLatencyHigh\n        expr: starrocks_fe_query_latency_ms{job="$job_name", quantile="0.95"} > 5000\n        for: 5m\n        labels:\n          severity: warning\n          category: performance\n        annotations:\n          summary: "\u67e5\u8be2\u5ef6\u8fdf\u8fc7\u9ad8"\n          description: "95th \u67e5\u8be2\u5ef6\u8fdf\u8d85\u8fc7 5 \u79d2\uff0c\u8bf7\u6392\u67e5\u5927\u67e5\u8be2\u5bfc\u81f4\u7684\u6027\u80fd\u95ee\u9898\u3002"\n\n      - alert: StarRocks_QueryErrorRateHigh\n        expr: sum by (job, instance)(starrocks_fe_query_err_rate{job="$job_name"}) * 100 > 10\n        for: 5m\n        labels:\n          severity: warning\n          category: query-error\n        annotations:\n          summary: "\u67e5\u8be2\u9519\u8bef\u7387\u8fc7\u9ad8"\n          description: "\u67e5\u8be2\u5931\u8d25\u7387\u8d85\u8fc7 10%\u3002\u8bf7\u68c0\u67e5\u76f8\u5173\u5931\u8d25 query\uff0c\u5b9a\u4f4d\u539f\u56e0\u3002"\n\n      - alert: StarRocks_QueryInternalErrorsHigh\n        expr: increase(starrocks_fe_query_internal_err{job="$job_name"}[1m]) > 10\n        for: 1m\n        labels:\n          severity: warning\n          category: query-error\n        annotations:\n          summary: "\u5185\u90e8\u67e5\u8be2\u9519\u8bef\u8fc7\u591a"\n          description: "1 \u5206\u949f\u5185 FE \u5185\u90e8\u9519\u8bef\u6570\u8d85\u8fc7 10\u3002\u8bf7\u68c0\u67e5 FE \u65e5\u5fd7\u3002"\n\n      - alert: StarRocks_QPSOrConnSpike\n        expr: increase(starrocks_fe_query_latency_ms{job="$job_name"}[1m]) / increase(starrocks_fe_query_latency_ms{job="$job_name"}[1m] offset 1m) > 2\n        for: 1m\n        labels:\n          severity: warning\n          category: traffic\n        annotations:\n          summary: "QPS \u6216\u8fde\u63a5\u6570\u6fc0\u589e"\n          description: "QPS \u6216\u8fde\u63a5\u6570\u5728 1 \u5206\u949f\u5185\u4e0a\u6da8\u8d85\u8fc7 100%\u3002\u8bf7\u786e\u8ba4\u662f\u5426\u4e3a\u4e1a\u52a1\u6d41\u91cf\u53d8\u5316\u5bfc\u81f4\u3002"\n\n      - alert: StarRocks_UserConnectionsHigh\n        expr: sum(starrocks_fe_connection_total{job="$job_name"}) by (user) > 90\n        for: 5m\n        labels:\n          severity: warning\n          category: connection\n        annotations:\n          summary: "\u7528\u6237\u8fde\u63a5\u6570\u8fc7\u591a"\n          description: "\u5355\u7528\u6237\u8fde\u63a5\u6570\u8d85\u8fc7 90\u3002\u53ef\u68c0\u67e5\u8fde\u63a5\u662f\u5426\u5f02\u5e38\u5e76\u9002\u5f53\u8c03\u6574 wait_timeout \u6216\u5f3a\u5236 KILL \u7a7a\u95f2\u8fde\u63a5\u3002"\n\n      - alert: StarRocks_SchemaChangeFailures\n        expr: increase(starrocks_be_engine_requests_total{job="$job_name", type="schema_change", status="failed"}[1m]) > 1\n        for: 1m\n        labels:\n          severity: warning\n          category: schema-change\n        annotations:\n          summary: "Schema Change \u5931\u8d25"\n          description: "Schema Change \u5931\u8d25\u8d85\u8fc7 1 \u6b21\uff0c\u8bf7\u4f7f\u7528 SHOW ALTER COLUMN \u68c0\u67e5\u9519\u8bef\u4fe1\u606f\u3002"\n\n      - alert: StarRocks_MVRefreshFailures\n        expr: increase(starrocks_fe_mv_refresh_total_failed_jobs[5m]) > 0\n        for: 5m\n        labels:\n          severity: warning\n          category: materialized-view\n        annotations:\n          summary: "MV \u5237\u65b0\u5931\u8d25"\n          description: "\u7269\u5316\u89c6\u56fe\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528 information_schema.materialized_views \u67e5\u770b\u5931\u8d25\u539f\u56e0\u3002"\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542f Prometheus \u4ee5\u52a0\u8f7d\u544a\u8b66\u89c4\u5219\uff0c\u5e76\u914d\u7f6e Alertmanager \u7684\u63a5\u6536\u5668\uff0c\u5373\u53ef\u5efa\u7acb\u8d77\u4e00\u5957\u5b8c\u6574\u7684\u76d1\u63a7\u544a\u8b66\u95ed\u73af\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var r=t(6540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);